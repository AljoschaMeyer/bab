<!doctype html><html><head><meta charset="utf-8" /><title>Preview lbls_max</title><link href="/bab/assets/index.css" rel="stylesheet" /><script src="/bab/assets/pretty_previews.js" type="module" defer></script><link href="/bab/assets/pseudocode.css" rel="stylesheet" /><script src="/bab/assets/defs.js" type="module" defer></script><script src="/bab/assets/pseudocode.js" type="module" defer></script></head><body class="isPreview"><div id="wrapContent"><code class="pseudocode"><div class="locGutter" data-l="1" data-i="0" id="code_include_labelsL1"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="1" href="#code_include_labelsL1">1</a></div><div class="fold"></div></div><div class="locContent"><div></div><div class="lineComment">Call <a class="rustic function" data-ref="include_labels" data-preview-anchor="/bab/previews/include_labels.html?def§include_labels" data-hl="true" href="#include_labels">include_labels</a> with the root of the tree as the first argument and the buffer capacity for unverified data as both the second and third argument. The function then sets <code>include_left_lbl</code> and <code>include_right_lbl</code> fields on <em>each</em> vertex in the tree that indicate which child labels the vertex contributes to the response stream.</div></div><div class="locGutter" data-l="2" data-i="0" id="code_include_labelsL2"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="2" href="#code_include_labelsL2">2</a></div><div class="fold"></div></div><div class="locContent"><div><span class="kw2">fn</span> <dfn id="include_labels"><a class="rustic function" data-ref="include_labels" data-preview-anchor="/bab/previews/include_labels.html?def§include_labels" data-hl="true" href="#include_labels">include_labels</a></dfn><span class="rb1 open">(</span><dfn id="lbls_v"><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a></dfn><span class="deemph">,</span> <dfn id="lbls_av"><a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a></dfn><span class="deemph">,</span> <dfn id="lbls_max"><a class="rustic value" data-ref="lbls_max" data-preview-anchor="/bab/previews/lbls_max.html?def§lbls_max" data-hl="true" href="#lbls_max">max</a></dfn><span class="rb1 close">)</span> <span class="deemph">-></span> <span class="rb1 open">{</span></div></div><div class="locGutter" data-l="3" data-i="1" id="code_include_labelsL3"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="3" href="#code_include_labelsL3">3</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><span class="kw">if</span> <a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> &gt;= leaves<span class="rb2 open">(</span><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>left<span class="rb2 close">)</span> * <a class="rustic value" data-ref="chunk_size" data-preview-anchor="/bab/previews/chunk_size.html?def§chunk_size" data-hl="true" href="#chunk_size">chunk_size</a> + <a class="rustic value" data-ref="width" data-preview-anchor="/bab/previews/width.html?def§width" data-hl="true" href="#width">width</a> <span class="rb2 open">{</span></div></div><div class="locGutter" data-l="4" data-i="2" id="code_include_labelsL4"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="4" href="#code_include_labelsL4">4</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div><div class="lineComment">We have sufficient available capacity to send all <a data-ref="chunk" data-preview-anchor="/bab/previews/chunk.html?def§chunk" data-hl="true" href="#chunk">chunks</a> of the left subtree without any verification metadata. Mark all vertices in the left subtree as not including their labels, also mark the current left label.</div></div><div class="locGutter" data-l="5" data-i="2" id="code_include_labelsL5"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="5" href="#code_include_labelsL5">5</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div>skip_all_labels<span class="rb0 open">(</span><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>left<span class="rb0 close">)</span></div></div><div class="locGutter" data-l="6" data-i="2" id="code_include_labelsL6"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="6" href="#code_include_labelsL6">6</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>include_left_lbl <span class="deemph">:=</span> false</div></div><div class="locGutter" data-l="7" data-i="2" id="code_include_labelsL7"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="7" href="#code_include_labelsL7">7</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> <span class="deemph">-=</span> leaves<span class="rb0 open">(</span><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>left<span class="rb0 close">)</span> * <a class="rustic value" data-ref="chunk_size" data-preview-anchor="/bab/previews/chunk_size.html?def§chunk_size" data-hl="true" href="#chunk_size">chunk_size</a> + <a class="rustic value" data-ref="width" data-preview-anchor="/bab/previews/width.html?def§width" data-hl="true" href="#width">width</a></div></div><div class="locGutter" data-l="8" data-i="2" id="code_include_labelsL8"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="8" href="#code_include_labelsL8">8</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div></div><div class="locGutter" data-l="9" data-i="2" id="code_include_labelsL9"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="9" href="#code_include_labelsL9">9</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div><div class="lineComment">Can we skip our right label as well?</div></div><div class="locGutter" data-l="10" data-i="2" id="code_include_labelsL10"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="10" href="#code_include_labelsL10">10</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><span class="kw">if</span> <a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> &gt;= <a class="rustic value" data-ref="width" data-preview-anchor="/bab/previews/width.html?def§width" data-hl="true" href="#width">width</a> <span class="rb0 open">{</span></div></div><div class="locGutter" data-l="11" data-i="3" id="code_include_labelsL11"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="11" href="#code_include_labelsL11">11</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>include_right_lbl <span class="deemph">:=</span> false</div></div><div class="locGutter" data-l="12" data-i="3" id="code_include_labelsL12"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="12" href="#code_include_labelsL12">12</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> <span class="deemph">-=</span> <a class="rustic value" data-ref="width" data-preview-anchor="/bab/previews/width.html?def§width" data-hl="true" href="#width">width</a></div></div><div class="locGutter" data-l="13" data-i="2" id="code_include_labelsL13"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="13" href="#code_include_labelsL13">13</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><span class="rb0 close">}</span> <span class="kw">else</span> <span class="rb0 open">{</span></div></div><div class="locGutter" data-l="14" data-i="3" id="code_include_labelsL14"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="14" href="#code_include_labelsL14">14</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>include_right_lbl <span class="deemph">:=</span> true</div></div><div class="locGutter" data-l="15" data-i="3" id="code_include_labelsL15"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="15" href="#code_include_labelsL15">15</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> <span class="deemph">:=</span> <a class="rustic value" data-ref="lbls_max" data-preview-anchor="/bab/previews/lbls_max.html?def§lbls_max" data-hl="true" href="#lbls_max">max</a></div></div><div class="locGutter" data-l="16" data-i="2" id="code_include_labelsL16"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="16" href="#code_include_labelsL16">16</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><span class="rb0 close">}</span></div></div><div class="locGutter" data-l="17" data-i="2" id="code_include_labelsL17"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="17" href="#code_include_labelsL17">17</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div></div><div class="locGutter" data-l="18" data-i="2" id="code_include_labelsL18"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="18" href="#code_include_labelsL18">18</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div><div class="lineComment">Recursively process the right child with the remaining capacity.</div></div><div class="locGutter" data-l="19" data-i="2" id="code_include_labelsL19"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="19" href="#code_include_labelsL19">19</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><a class="rustic function" data-ref="include_labels" data-preview-anchor="/bab/previews/include_labels.html?def§include_labels" data-hl="true" href="#include_labels">include_labels</a><span class="rb0 open">(</span><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>right<span class="deemph">,</span> <a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a><span class="deemph">,</span> <a class="rustic value" data-ref="lbls_max" data-preview-anchor="/bab/previews/lbls_max.html?def§lbls_max" data-hl="true" href="#lbls_max">max</a><span class="rb0 close">)</span></div></div><div class="locGutter" data-l="20" data-i="1" id="code_include_labelsL20"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="20" href="#code_include_labelsL20">20</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><span class="rb2 close">}</span> <span class="kw">else</span> <span class="rb2 open">{</span></div></div><div class="locGutter" data-l="21" data-i="2" id="code_include_labelsL21"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="21" href="#code_include_labelsL21">21</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div><div class="lineComment">We cannot omit all labels for the left subtree. We include the label of our right child, so that the left subtree becomes verifiable as soon as possible. For our right subtree, we can hence start with full buffer capacity again.</div></div><div class="locGutter" data-l="22" data-i="2" id="code_include_labelsL22"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="22" href="#code_include_labelsL22">22</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>include_right_lbl <span class="deemph">:=</span> true</div></div><div class="locGutter" data-l="23" data-i="2" id="code_include_labelsL23"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="23" href="#code_include_labelsL23">23</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><a class="rustic function" data-ref="include_labels" data-preview-anchor="/bab/previews/include_labels.html?def§include_labels" data-hl="true" href="#include_labels">include_labels</a><span class="rb0 open">(</span><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>right<span class="deemph">,</span> <a class="rustic value" data-ref="lbls_max" data-preview-anchor="/bab/previews/lbls_max.html?def§lbls_max" data-hl="true" href="#lbls_max">max</a><span class="deemph">,</span> <a class="rustic value" data-ref="lbls_max" data-preview-anchor="/bab/previews/lbls_max.html?def§lbls_max" data-hl="true" href="#lbls_max">max</a><span class="rb0 close">)</span></div></div><div class="locGutter" data-l="24" data-i="2" id="code_include_labelsL24"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="24" href="#code_include_labelsL24">24</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div></div><div class="locGutter" data-l="25" data-i="2" id="code_include_labelsL25"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="25" href="#code_include_labelsL25">25</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div><div class="lineComment">Can we at least skip <em>our</em> left label?</div></div><div class="locGutter" data-l="26" data-i="2" id="code_include_labelsL26"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="26" href="#code_include_labelsL26">26</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><span class="kw">if</span> <a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> &gt;= <a class="rustic value" data-ref="width" data-preview-anchor="/bab/previews/width.html?def§width" data-hl="true" href="#width">width</a> <span class="rb0 open">{</span></div></div><div class="locGutter" data-l="27" data-i="3" id="code_include_labelsL27"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="27" href="#code_include_labelsL27">27</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>include_left_lbl <span class="deemph">:=</span> false</div></div><div class="locGutter" data-l="28" data-i="3" id="code_include_labelsL28"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="28" href="#code_include_labelsL28">28</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> <span class="deemph">-=</span> <a class="rustic value" data-ref="width" data-preview-anchor="/bab/previews/width.html?def§width" data-hl="true" href="#width">width</a></div></div><div class="locGutter" data-l="29" data-i="2" id="code_include_labelsL29"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="29" href="#code_include_labelsL29">29</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><span class="rb0 close">}</span> <span class="kw">else</span> <span class="rb0 open">{</span></div></div><div class="locGutter" data-l="30" data-i="3" id="code_include_labelsL30"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="30" href="#code_include_labelsL30">30</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>include_left_lbl <span class="deemph">:=</span> true</div></div><div class="locGutter" data-l="31" data-i="3" id="code_include_labelsL31"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="31" href="#code_include_labelsL31">31</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><div class="indent"> </div><a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a> <span class="deemph">:=</span> <a class="rustic value" data-ref="lbls_max" data-preview-anchor="/bab/previews/lbls_max.html?def§lbls_max" data-hl="true" href="#lbls_max">max</a></div></div><div class="locGutter" data-l="32" data-i="2" id="code_include_labelsL32"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="32" href="#code_include_labelsL32">32</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><span class="rb0 close">}</span></div></div><div class="locGutter" data-l="33" data-i="2" id="code_include_labelsL33"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="33" href="#code_include_labelsL33">33</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div></div><div class="locGutter" data-l="34" data-i="2" id="code_include_labelsL34"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="34" href="#code_include_labelsL34">34</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div></div><div class="lineComment">Recursively process the left child with the remaining capacity.</div></div><div class="locGutter" data-l="35" data-i="2" id="code_include_labelsL35"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="35" href="#code_include_labelsL35">35</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><div class="indent"> </div><a class="rustic function" data-ref="include_labels" data-preview-anchor="/bab/previews/include_labels.html?def§include_labels" data-hl="true" href="#include_labels">include_labels</a><span class="rb0 open">(</span><a class="rustic value" data-ref="lbls_v" data-preview-anchor="/bab/previews/lbls_v.html?def§lbls_v" data-hl="true" href="#lbls_v">v</a><span class="deemph">.</span>left<span class="deemph">,</span> <a class="rustic value" data-ref="lbls_av" data-preview-anchor="/bab/previews/lbls_av.html?def§lbls_av" data-hl="true" href="#lbls_av">available</a><span class="deemph">,</span> <a class="rustic value" data-ref="lbls_max" data-preview-anchor="/bab/previews/lbls_max.html?def§lbls_max" data-hl="true" href="#lbls_max">max</a><span class="rb0 close">)</span></div></div><div class="locGutter" data-l="36" data-i="1" id="code_include_labelsL36"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="36" href="#code_include_labelsL36">36</a></div><div class="fold"></div></div><div class="locContent"><div><div class="indent"> </div><span class="rb2 close">}</span></div></div><div class="locGutter" data-l="37" data-i="0" id="code_include_labelsL37"><div class="lineNumber"><a data-pseudocode="code_include_labels" data-ref="code_include_labels" data-hllines="37" href="#code_include_labelsL37">37</a></div><div class="fold"></div></div><div class="locContent"><div><span class="rb1 close">}</span></div></div></code></div></body></html>